<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudentScope Arcade - Atari Edition</title>
<style>
:root {
  --primary: #F59E0B;
  --primary-dark: #D97706;
  --secondary: #10B981;
  --danger: #EF4444;
  --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Courier New', monospace;
  background: var(--bg-gradient);
  min-height: 100vh;
  color: #fff;
}

/* LOGIN SCREEN */
.auth-container {
  max-width: 400px;
  margin: 20vh auto;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  padding: 40px;
  border-radius: 20px;
  border: 2px solid var(--primary);
  text-align: center;
}

.auth-container h1 {
  color: var(--primary);
  font-size: 2.5rem;
  margin-bottom: 10px;
  text-shadow: 0 0 10px var(--primary);
}

.student-code-input {
  width: 100%;
  padding: 20px;
  font-size: 32px;
  text-align: center;
  letter-spacing: 8px;
  background: rgba(255,255,255,0.1);
  border: 3px solid var(--primary);
  border-radius: 12px;
  color: white;
  margin: 20px 0;
  text-transform: uppercase;
}

.play-btn {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 10px;
  font-weight: bold;
  font-size: 1.2rem;
  cursor: pointer;
  width: 100%;
  font-family: 'Courier New', monospace;
}

.play-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* MAIN PORTAL */
.portal {
  max-width: 1200px;
  margin: 2rem auto;
  padding: 1rem;
  display: none;
}

.portal.active {
  display: block;
}

/* HEADER */
.header {
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 2px solid var(--primary);
}

.student-info h1 {
  font-size: 2rem;
  color: var(--primary);
}

.points-display {
  background: var(--primary);
  padding: 15px 30px;
  border-radius: 50px;
  text-align: center;
  box-shadow: 0 0 20px var(--primary);
}

.points-number {
  font-size: 3rem;
  font-weight: bold;
  line-height: 1;
}

/* GAMES GRID */
.games-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.game-card {
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 20px;
  border: 2px solid var(--primary);
  transition: all 0.3s;
  cursor: pointer;
}

.game-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0 30px var(--primary);
}

.game-icon {
  font-size: 4rem;
  text-align: center;
  margin-bottom: 10px;
}

.game-title {
  font-size: 1.5rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 10px;
  color: var(--primary);
}

.game-cost {
  background: var(--primary-dark);
  padding: 5px 10px;
  border-radius: 20px;
  display: inline-block;
  margin: 10px auto;
  text-align: center;
  width: 100%;
}

/* GAME MODAL */
.game-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.95);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.game-modal.active {
  display: flex;
}

.game-frame {
  background: #000;
  padding: 20px;
  border-radius: 15px;
  max-width: 900px;
  width: 90%;
  position: relative;
  border: 3px solid var(--primary);
}

.close-game {
  position: absolute;
  top: -15px;
  right: -15px;
  background: var(--danger);
  color: white;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  z-index: 1001;
}

.game-timer {
  background: var(--primary);
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 10px;
  text-align: center;
  font-size: 1.2rem;
  font-weight: bold;
}

.game-frame iframe {
  width: 100%;
  height: 500px;
  border: none;
}

/* PROGRESS */
.recent-behaviors {
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 20px;
  margin-top: 20px;
  border: 2px solid var(--primary);
}

.behavior-item {
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  display: flex;
  justify-content: space-between;
}

.behavior-item:last-child {
  border-bottom: none;
}

.positive { color: var(--secondary); }
.negative { color: var(--danger); }

.hidden { display: none; }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="authScreen" class="auth-container">
  <h1>üéÆ ATARI ARCADE</h1>
  <p>Enter your access code</p>
  <input type="text" id="accessCode" class="student-code-input" maxlength="6" placeholder="ABC123">
  <button id="loginBtn" class="play-btn">ENTER ARCADE</button>
  <div id="loginError" style="color: var(--danger); margin-top: 15px; display: none;"></div>
</div>

<!-- MAIN PORTAL -->
<div id="portal" class="portal">
  <div class="header">
    <div class="student-info">
      <h1 id="studentName">Loading...</h1>
      <p id="grade"></p>
    </div>
    <div class="points-display">
      <div class="points-number" id="points">0</div>
      <div>BEHAVIOR BUCKS</div>
    </div>
    <button id="logoutBtn" style="background: none; border: 2px solid var(--primary); color: white; padding: 10px 20px; border-radius: 10px; cursor: pointer;">EXIT</button>
  </div>

  <!-- GAMES GRID -->
  <h2 style="margin: 20px 0;">üéÆ SELECT GAME</h2>
  <div class="games-grid" id="gamesGrid"></div>

  <!-- RECENT BEHAVIORS -->
  <div class="recent-behaviors">
    <h2>üìã RECENT RECOGNITION</h2>
    <div id="behaviorFeed"></div>
  </div>
</div>

<!-- GAME MODAL -->
<div id="gameModal" class="game-modal">
  <div class="game-frame">
    <button class="close-game" onclick="Arcade.closeGame()">‚úï</button>
    <div class="game-timer" id="gameTimer">Time: 5:00</div>
    <iframe id="gameFrame" allowfullscreen></iframe>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// ========== FIREBASE CONFIG ==========
const firebaseConfig = {
  apiKey: "AIzaSyDFI44iKYUJNu9-67UkfHQHeKHBRAjKleA",
  authDomain: "studentscopebehaviorcenter.firebaseapp.com",
  projectId: "studentscopebehaviorcenter",
  storageBucket: "studentscopebehaviorcenter.firebasestorage.app",
  messagingSenderId: "311398911099",
  appId: "1:311398911099:web:6703268a2b65cdd969a6de"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ========== ATARI GAMES ==========
const GAMES = [
  { name: "SPACE INVADERS", icon: "üëæ", cost: 50, url: "https://archive.org/embed/space_invaders_atari_2600" },
  { name: "ASTEROIDS", icon: "‚òÑÔ∏è", cost: 60, url: "https://archive.org/embed/a26_asteroids_1981_atari_pal" },
  { name: "MISSILE COMMAND", icon: "üöÄ", cost: 55, url: "https://archive.org/embed/a26_missile_command_1981_atari" },
  { name: "ADVENTURE", icon: "üè∞", cost: 45, url: "https://archive.org/embed/a26_adventure_1980_atari" },
  { name: "COMBAT", icon: "üí•", cost: 40, url: "https://archive.org/embed/a26_combat_1977_atari" },
  { name: "YARS' REVENGE", icon: "ü¶ã", cost: 65, url: "https://archive.org/embed/a26_yars_revenge_1982_atari" },
  { name: "PITFALL", icon: "üå¥", cost: 70, url: "https://archive.org/embed/a26_pitfall_1982_activision" },
  { name: "RIVER RAID", icon: "üåä", cost: 65, url: "https://archive.org/embed/a26_river_raid_1982_activision" },
  { name: "FROGGER", icon: "üê∏", cost: 55, url: "https://archive.org/embed/a26_frogger_1982_parker_brothers" },
  { name: "DONKEY KONG", icon: "ü¶ç", cost: 80, url: "https://archive.org/embed/a26_donkey_kong_1982_coleco" },
  { name: "CENTIPEDE", icon: "üêõ", cost: 60, url: "https://archive.org/embed/a26_centipede_1983_atari" },
  { name: "DEFENDER", icon: "üõ∏", cost: 70, url: "https://archive.org/embed/a26_defender_1982_atari" },
  { name: "BERZERK", icon: "ü§ñ", cost: 50, url: "https://archive.org/embed/a26_berzerk_1982_atari" },
  { name: "DEMON ATTACK", icon: "üëπ", cost: 55, url: "https://archive.org/embed/a26_demon_attack_1982_imagic" },
  { name: "MEGAMANIA", icon: "üí´", cost: 60, url: "https://archive.org/embed/a26_megamania_1982_activision" },
  { name: "PAC-MAN", icon: "üëª", cost: 75, url: "https://archive.org/embed/a26_pac-man_1982_atari" },
  { name: "E.T.", icon: "üìû", cost: 85, url: "https://archive.org/embed/a26_e.t._the_extra-terrestrial_1982_atari" },
  { name: "FROSTBITE", icon: "‚ùÑÔ∏è", cost: 50, url: "https://archive.org/embed/a26_frostbite_1983_activision" },
  { name: "H.E.R.O.", icon: "‚õëÔ∏è", cost: 65, url: "https://archive.org/embed/a26_hero_1984_activision" },
  { name: "KABOOM", icon: "üí£", cost: 45, url: "https://archive.org/embed/a26_kaboom_1981_activision" }
];

// ========== ARCADE ==========
const Arcade = {
  currentStudent: null,
  currentPoints: 0,
  gameTimer: null,
  gameTimeLeft: 300,

  init() {
    document.getElementById('loginBtn').addEventListener('click', () => this.login());
    document.getElementById('accessCode').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.login();
    });
    document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
    this.renderGames();
  },

  renderGames() {
    const grid = document.getElementById('gamesGrid');
    grid.innerHTML = GAMES.map(game => `
      <div class="game-card" onclick="Arcade.playGame('${game.url}', ${game.cost})">
        <div class="game-icon">${game.icon}</div>
        <div class="game-title">${game.name}</div>
        <div class="game-cost">${game.cost} POINTS</div>
      </div>
    `).join('');
  },

  async login() {
    const code = document.getElementById('accessCode').value.trim().toUpperCase();
    
    if (!code || code.length !== 6) {
      this.showError('Enter a valid 6-character code');
      return;
    }

    try {
      const studentSnapshot = await db.collection('students')
        .where('accessCode', '==', code)
        .get();

      if (studentSnapshot.empty) {
        this.showError('Invalid code');
        return;
      }

      const studentDoc = studentSnapshot.docs[0];
      this.currentStudent = { id: studentDoc.id, ...studentDoc.data() };
      
      if (!this.currentStudent.points) {
        await studentDoc.ref.update({ points: 0 });
        this.currentStudent.points = 0;
      }
      
      this.currentPoints = this.currentStudent.points;
      
      document.getElementById('authScreen').style.display = 'none';
      document.getElementById('portal').classList.add('active');
      
      this.updateUI();
      this.loadBehaviors();
      
    } catch (error) {
      this.showError('Login failed');
    }
  },

  logout() {
    this.currentStudent = null;
    document.getElementById('authScreen').style.display = 'block';
    document.getElementById('portal').classList.remove('active');
    document.getElementById('accessCode').value = '';
  },

  showError(message) {
    const errorDiv = document.getElementById('loginError');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    setTimeout(() => errorDiv.style.display = 'none', 3000);
  },

  updateUI() {
    document.getElementById('studentName').textContent = this.currentStudent.name;
    document.getElementById('grade').textContent = `Grade ${this.currentStudent.grade || 'N/A'}`;
    document.getElementById('points').textContent = this.currentPoints;
  },

  async playGame(url, cost) {
    if (this.currentPoints < cost) {
      alert(`Need ${cost} points! Earn more by being awesome!`);
      return;
    }

    // Deduct points
    const newPoints = this.currentPoints - cost;
    await db.collection('students').doc(this.currentStudent.id).update({
      points: newPoints
    });
    this.currentPoints = newPoints;
    this.updateUI();

    // Open game
    document.getElementById('gameModal').classList.add('active');
    document.getElementById('gameFrame').src = url;

    // Start timer
    this.gameTimeLeft = 300;
    this.updateTimer();
    this.gameTimer = setInterval(() => this.updateTimer(), 1000);
  },

  updateTimer() {
    this.gameTimeLeft--;
    const minutes = Math.floor(this.gameTimeLeft / 60);
    const seconds = this.gameTimeLeft % 60;
    document.getElementById('gameTimer').textContent = 
      `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;

    if (this.gameTimeLeft <= 0) {
      this.closeGame();
      alert("Time's up! Great job! Come back and play again!");
    }
  },

  closeGame() {
    clearInterval(this.gameTimer);
    document.getElementById('gameModal').classList.remove('active');
    document.getElementById('gameFrame').src = '';
  },

  async loadBehaviors() {
    const snapshot = await db.collection('behaviors')
      .where('studentId', '==', this.currentStudent.id)
      .orderBy('timestamp', 'desc')
      .limit(10)
      .get();

    const feed = document.getElementById('behaviorFeed');
    feed.innerHTML = '';

    if (snapshot.empty) {
      feed.innerHTML = '<p>No behaviors yet. Be your best self!</p>';
      return;
    }

    snapshot.forEach(doc => {
      const b = doc.data();
      const date = new Date(b.timestamp).toLocaleDateString();
      const points = b.type === 'positive' ? '+10' : '-5';
      feed.innerHTML += `
        <div class="behavior-item">
          <span>${b.type === 'positive' ? '‚≠ê' : 'üìù'} ${b.behavior}</span>
          <span class="${b.type === 'positive' ? 'positive' : 'negative'}">${points}</span>
        </div>
      `;
    });
  }
};

// Start
document.addEventListener('DOMContentLoaded', () => Arcade.init());
</script>
</body>
</html>
