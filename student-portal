<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudentScope Arcade</title>
<style>
:root {
  --primary: #F59E0B;
  --primary-dark: #D97706;
  --secondary: #10B981;
  --accent: #8B5CF6;
  --danger: #EF4444;
  --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-gradient);
  min-height: 100vh;
  color: #1F2937;
}

/* LOGIN SCREEN */
.auth-container {
  max-width: 400px;
  margin: 10vh auto;
  background: white;
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

.student-code-input {
  width: 100%;
  padding: 20px;
  font-size: 32px;
  text-align: center;
  letter-spacing: 8px;
  border: 3px solid var(--primary);
  border-radius: 12px;
  margin: 20px 0;
  text-transform: uppercase;
  font-family: monospace;
}

/* MAIN PORTAL */
.portal {
  max-width: 1200px;
  margin: 2rem auto;
  padding: 0 1rem;
}

/* HEADER WITH POINTS */
.header {
  background: white;
  border-radius: 20px;
  padding: 20px 30px;
  margin-bottom: 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.student-info h1 {
  font-size: 2rem;
  color: var(--primary-dark);
}

.points-display {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  padding: 15px 30px;
  border-radius: 50px;
  text-align: center;
}

.points-number {
  font-size: 2.5rem;
  font-weight: 800;
  line-height: 1;
}

.points-label {
  font-size: 0.9rem;
  opacity: 0.9;
}

/* PROGRESS SECTION */
.progress-section {
  background: white;
  border-radius: 20px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.progress-bars {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-top: 20px;
}

.progress-item {
  text-align: center;
}

.progress-circle {
  width: 120px;
  height: 120px;
  margin: 0 auto 15px;
  position: relative;
}

.circle-bg {
  fill: none;
  stroke: #e0e0e0;
  stroke-width: 8;
}

.circle-progress {
  fill: none;
  stroke: var(--primary);
  stroke-width: 8;
  stroke-linecap: round;
  transform: rotate(-90deg);
  transform-origin: 50% 50%;
  transition: stroke-dasharray 0.3s;
}

.progress-stats {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 15px;
}

.stat {
  text-align: center;
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--primary);
}

.stat-label {
  font-size: 0.85rem;
  color: #6B7280;
}

/* GAMES GRID */
.games-section {
  background: white;
  border-radius: 20px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.games-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.game-card {
  background: linear-gradient(135deg, #f6f9fc 0%, #e9f2f9 100%);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}

.game-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.15);
}

.game-card.locked {
  opacity: 0.7;
  filter: grayscale(0.5);
  pointer-events: none;
}

.game-icon {
  font-size: 4rem;
  margin-bottom: 15px;
}

.game-title {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 10px;
  color: #2C3E50;
}

.game-cost {
  background: var(--primary);
  color: white;
  padding: 8px 15px;
  border-radius: 25px;
  display: inline-block;
  margin: 15px 0;
  font-weight: 700;
}

.play-btn {
  background: linear-gradient(135deg, var(--secondary), #0EA5E9);
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 25px;
  font-weight: 700;
  cursor: pointer;
  width: 100%;
  font-size: 1.1rem;
}

.play-btn:disabled {
  background: #CBD5E0;
  cursor: not-allowed;
}

/* GAME MODAL */
.game-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.9);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.game-modal.active {
  display: flex;
}

.game-frame {
  background: #1a1a2e;
  padding: 20px;
  border-radius: 15px;
  max-width: 800px;
  width: 90%;
  max-height: 80vh;
  position: relative;
}

.close-game {
  position: absolute;
  top: -10px;
  right: -10px;
  background: var(--danger);
  color: white;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  z-index: 1001;
}

.game-timer {
  background: white;
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 10px;
  text-align: center;
  font-size: 1.2rem;
  font-weight: 700;
}

/* BEHAVIOR FEED */
.recent-behaviors {
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.behavior-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 12px;
  border-bottom: 1px solid #E5E7EB;
}

.behavior-item:last-child {
  border-bottom: none;
}

.behavior-icon {
  font-size: 1.5rem;
}

.behavior-positive {
  color: var(--secondary);
}

.behavior-negative {
  color: var(--danger);
}

/* UTILITIES */
.hidden { display: none; }
.loading { text-align: center; padding: 40px; }
</style>
</head>
<body>

<!-- AUTH SCREEN -->
<div id="authScreen" class="auth-container">
  <h1 style="text-align:center; color: var(--primary); margin-bottom: 10px;">üéÆ StudentScope Arcade</h1>
  <p style="text-align:center; color: #6B7280; margin-bottom: 30px;">Enter your access code to play</p>
  
  <input type="text" id="accessCode" class="student-code-input" maxlength="6" placeholder="ABC123">
  <button id="loginBtn" class="play-btn" style="margin-top: 20px;">ENTER ARCADE</button>
  
  <div id="loginError" style="color: var(--danger); text-align: center; margin-top: 15px; display: none;"></div>
</div>

<!-- MAIN PORTAL -->
<div id="portal" class="portal hidden">
  <!-- Header -->
  <div class="header">
    <div class="student-info">
      <h1 id="studentName">Loading...</h1>
      <p id="grade" style="color: #6B7280;"></p>
    </div>
    <div class="points-display">
      <div class="points-number" id="points">0</div>
      <div class="points-label">Behavior Bucks</div>
    </div>
    <button id="logoutBtn" style="background: none; border: 2px solid #CBD5E0; padding: 8px 16px; border-radius: 8px; cursor: pointer;">üö™ Exit</button>
  </div>

  <!-- Progress Section -->
  <div class="progress-section">
    <h2>üìä Your Progress This Week</h2>
    <div class="progress-bars">
      <div class="progress-item">
        <h3>Positive Behaviors</h3>
        <div class="progress-circle">
          <svg width="120" height="120">
            <circle class="circle-bg" cx="60" cy="60" r="50"></circle>
            <circle class="circle-progress" id="positiveProgress" cx="60" cy="60" r="50" style="stroke-dasharray: 0, 314;"></circle>
          </svg>
        </div>
        <div class="stat-value" id="positiveCount">0</div>
      </div>
      <div class="progress-item">
        <h3>Total Points</h3>
        <div class="progress-circle">
          <svg width="120" height="120">
            <circle class="circle-bg" cx="60" cy="60" r="50"></circle>
            <circle class="circle-progress" id="pointsProgress" cx="60" cy="60" r="50" style="stroke-dasharray: 0, 314;"></circle>
          </svg>
        </div>
        <div class="stat-value" id="pointsEarned">0</div>
      </div>
    </div>
  </div>

  <!-- Games Section -->
  <div class="games-section">
    <h2>üéÆ Arcade Rewards</h2>
    <div class="games-grid" id="gamesGrid">
      <!-- Tetris -->
      <div class="game-card" id="gameTetris">
        <div class="game-icon">üß©</div>
        <div class="game-title">TETRIS</div>
        <div class="game-cost">50 points</div>
        <p style="color: #6B7280; margin-bottom: 15px;">Classic block stacking fun!</p>
        <button class="play-btn" onclick="Arcade.playGame('tetris', 50)">PLAY - 5 MINUTES</button>
      </div>

      <!-- Typing Game -->
      <div class="game-card" id="gameTyping">
        <div class="game-icon">‚å®Ô∏è</div>
        <div class="game-title">TYPING CHALLENGE</div>
        <div class="game-cost">30 points</div>
        <p style="color: #6B7280; margin-bottom: 15px;">Improve your typing speed!</p>
        <button class="play-btn" onclick="Arcade.playGame('typing', 30)">PLAY - 5 MINUTES</button>
      </div>

      <!-- Pac-Man -->
      <div class="game-card" id="gamePacman">
        <div class="game-icon">üëæ</div>
        <div class="game-title">PAC-MAN</div>
        <div class="game-cost">75 points</div>
        <p style="color: #6B7280; margin-bottom: 15px;">Waka waka waka!</p>
        <button class="play-btn" onclick="Arcade.playGame('pacman', 75)">PLAY - 5 MINUTES</button>
      </div>

      <!-- Memory Game -->
      <div class="game-card" id="gameMemory">
        <div class="game-icon">üß†</div>
        <div class="game-title">MEMORY MATCH</div>
        <div class="game-cost">40 points</div>
        <p style="color: #6B7280; margin-bottom: 15px;">Test your memory!</p>
        <button class="play-btn" onclick="Arcade.playGame('memory', 40)">PLAY - 5 MINUTES</button>
      </div>
    </div>
  </div>

  <!-- Recent Behavior Feed -->
  <div class="recent-behaviors">
    <h2>üìã Recent Recognition</h2>
    <div id="behaviorFeed"></div>
  </div>
</div>

<!-- GAME MODAL -->
<div id="gameModal" class="game-modal">
  <div class="game-frame">
    <button class="close-game" onclick="Arcade.closeGame()">‚úï</button>
    <div class="game-timer" id="gameTimer">Time remaining: 5:00</div>
    <iframe id="gameFrame" style="width: 100%; height: 500px; border: none; background: white;"></iframe>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDFI44iKYUJNu9-67UkfHQHeKHBRAjKleA",
  authDomain: "studentscopebehaviorcenter.firebaseapp.com",
  projectId: "studentscopebehaviorcenter",
  storageBucket: "studentscopebehaviorcenter.firebasestorage.app",
  messagingSenderId: "311398911099",
  appId: "1:311398911099:web:6703268a2b65cdd969a6de"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Student Arcade
const Arcade = {
  currentStudent: null,
  currentPoints: 0,
  gameTimer: null,
  gameTimeLeft: 300, // 5 minutes in seconds
  
  init() {
    document.getElementById('loginBtn').addEventListener('click', () => this.login());
    document.getElementById('accessCode').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.login();
    });
    document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
  },
  
  async login() {
    const code = document.getElementById('accessCode').value.trim().toUpperCase();
    
    if (!code || code.length !== 6) {
      this.showError('Please enter a valid 6-character code');
      return;
    }
    
    try {
      // Find student by access code
      const studentSnapshot = await db.collection('students')
        .where('accessCode', '==', code)
        .get();
      
      if (studentSnapshot.empty) {
        this.showError('Invalid access code');
        return;
      }
      
      const studentDoc = studentSnapshot.docs[0];
      this.currentStudent = { id: studentDoc.id, ...studentDoc.data() };
      
      // Initialize points if not exists
      if (!this.currentStudent.points) {
        await studentDoc.ref.update({ points: 0 });
        this.currentStudent.points = 0;
      }
      
      this.currentPoints = this.currentStudent.points;
      
      // Show portal
      document.getElementById('authScreen').classList.add('hidden');
      document.getElementById('portal').classList.remove('hidden');
      
      this.updateUI();
      this.loadBehaviors();
      
    } catch (error) {
      console.error('Login error:', error);
      this.showError('Failed to login. Please try again.');
    }
  },
  
  logout() {
    this.currentStudent = null;
    document.getElementById('authScreen').classList.remove('hidden');
    document.getElementById('portal').classList.add('hidden');
    document.getElementById('accessCode').value = '';
  },
  
  showError(message) {
    const errorDiv = document.getElementById('loginError');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    setTimeout(() => errorDiv.style.display = 'none', 3000);
  },
  
  async updateUI() {
    document.getElementById('studentName').textContent = this.currentStudent.name;
    document.getElementById('grade').textContent = `Grade ${this.currentStudent.grade || 'N/A'}`;
    document.getElementById('points').textContent = this.currentPoints;
    
    // Update game card states based on points
    const gameCards = document.querySelectorAll('.game-card');
    gameCards.forEach(card => {
      const cost = parseInt(card.querySelector('.game-cost').textContent);
      const btn = card.querySelector('.play-btn');
      if (this.currentPoints < cost) {
        btn.disabled = true;
        btn.textContent = `Need ${cost} points`;
      } else {
        btn.disabled = false;
        btn.textContent = 'PLAY - 5 MINUTES';
      }
    });
  },
  
  async loadBehaviors() {
    const snapshot = await db.collection('behaviors')
      .where('studentId', '==', this.currentStudent.id)
      .orderBy('timestamp', 'desc')
      .limit(10)
      .get();
    
    const feed = document.getElementById('behaviorFeed');
    feed.innerHTML = '';
    
    if (snapshot.empty) {
      feed.innerHTML = '<p style="text-align: center; color: #6B7280;">No behaviors logged yet. Be your best self!</p>';
      return;
    }
    
    let positiveCount = 0;
    let pointsEarned = 0;
    
    snapshot.forEach(doc => {
      const behavior = doc.data();
      const date = new Date(behavior.timestamp).toLocaleDateString();
      const points = behavior.type === 'positive' ? 10 : -5;
      
      if (behavior.type === 'positive') {
        positiveCount++;
        pointsEarned += points;
      }
      
      const item = document.createElement('div');
      item.className = 'behavior-item';
      item.innerHTML = `
        <div class="behavior-icon ${behavior.type === 'positive' ? 'behavior-positive' : 'behavior-negative'}">
          ${behavior.type === 'positive' ? '‚≠ê' : 'üìù'}
        </div>
        <div style="flex: 1;">
          <div style="font-weight: 600;">${behavior.behavior}</div>
          <div style="color: #6B7280; font-size: 0.9rem;">${date}</div>
        </div>
        <div style="font-weight: 700; color: ${behavior.type === 'positive' ? '#10B981' : '#EF4444'}">
          ${behavior.type === 'positive' ? '+' : ''}${points}
        </div>
      `;
      feed.appendChild(item);
    });
    
    // Update progress stats
    document.getElementById('positiveCount').textContent = positiveCount;
    document.getElementById('pointsEarned').textContent = pointsEarned;
    
    // Update progress circles
    const positiveProgress = (positiveCount / 20) * 314; // Max 20 positives
    document.getElementById('positiveProgress').style.strokeDasharray = `${positiveProgress}, 314`;
    
    const pointsProgress = (this.currentPoints / 200) * 314; // Max 200 points
    document.getElementById('pointsProgress').style.strokeDasharray = `${pointsProgress}, 314`;
  },
  
  async playGame(game, cost) {
    if (this.currentPoints < cost) {
      alert(`You need ${cost} points to play!`);
      return;
    }
    
    // Deduct points
    const newPoints = this.currentPoints - cost;
    await db.collection('students').doc(this.currentStudent.id).update({
      points: newPoints
    });
    this.currentPoints = newPoints;
    this.updateUI();
    
    // Open game
    document.getElementById('gameModal').classList.add('active');
    const gameFrame = document.getElementById('gameFrame');
    
    // Load game based on selection
    switch(game) {
      case 'tetris':
        gameFrame.src = 'https://tetris.com/play-tetris';
        break;
      case 'typing':
        gameFrame.src = 'https://www.typing.com/student/games';
        break;
      case 'pacman':
        gameFrame.src = 'https://www.google.com/logos/2010/pacman10-i.html';
        break;
      case 'memory':
        gameFrame.src = 'https://www.crazygames.com/game/memory-match';
        break;
    }
    
    // Start timer
    this.gameTimeLeft = 300;
    this.updateTimer();
    this.gameTimer = setInterval(() => this.updateTimer(), 1000);
  },
  
  updateTimer() {
    this.gameTimeLeft--;
    const minutes = Math.floor(this.gameTimeLeft / 60);
    const seconds = this.gameTimeLeft % 60;
    document.getElementById('gameTimer').textContent = 
      `Time remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (this.gameTimeLeft <= 0) {
      this.closeGame();
    }
  },
  
  closeGame() {
    clearInterval(this.gameTimer);
    document.getElementById('gameModal').classList.remove('active');
    document.getElementById('gameFrame').src = '';
  }
};

// Initialize
document.addEventListener('DOMContentLoaded', () => Arcade.init());
</script>
</body>
</html>
